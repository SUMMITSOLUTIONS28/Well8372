<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Survey | Peter Simiyu 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
    *{margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif;}
    body{background: linear-gradient(to right, #00c6ff, #0072ff); color:#fff; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding:20px;}
    .container{background: rgba(0,0,0,0.3); padding:25px; border-radius:20px; max-width:900px; width:100%; margin-top:30px; box-shadow:0 10px 25px rgba(0,0,0,0.3);}
    h1{color:#ffeb3b; text-align:center; margin-bottom:20px; text-shadow:1px 1px 5px #000;}
    .question{background: rgba(255,255,255,0.1); padding:15px; margin-bottom:15px; border-radius:12px;}
    button{margin:5px 0; padding:10px 15px; border:none; border-radius:10px; cursor:pointer; width:100%; font-weight:600; transition:0.3s;}
    button:hover{transform:scale(1.03);}
    #balance{margin-top:10px; font-size:1.1rem; font-weight:600;}
    #withdrawBtn{margin-top:15px; background:#ffeb3b; color:#000; font-weight:700;}
</style>
</head>
<body>

<div class="container">
    <h1>Health Survey</h1>
    <div id="survey-container"></div>
    <div id="balance">Your balance: Ksh 0</div>
    <button id="withdrawBtn">Withdraw</button>
    <p style="margin-top:10px;font-size:0.9rem;">© Peter Simiyu 2026. All rights reserved.</p>
</div>

<script>
const questions = [
    // Mixed 15 health questions (5 complex, 5 normal, 5 easy) shuffled manually
    {q:"Which vitamin is essential for blood clotting?", a:["Vitamin A","Vitamin D","Vitamin K","Vitamin C"], correct:2},
    {q:"Normal BMI range for adults?", a:["18.5–24.9","25–29.9","30–34.9","35–39.9"], correct:0},
    {q:"Which organ filters toxins from the blood?", a:["Kidney","Liver","Pancreas","Spleen"], correct:1},
    {q:"Recommended daily water intake for adults?", a:["1–1.5L","2–3L","4–5L","5–6L"], correct:1},
    {q:"Which nutrient helps build muscles?", a:["Carbs","Fats","Proteins","Vitamins"], correct:2},
    {q:"A healthy adult heart rate?", a:["60–100 bpm","100–120 bpm","40–50 bpm","120–140 bpm"], correct:0},
    {q:"Hygiene practice that prevents infections?", a:["Washing hands","Sleeping late","Skipping meals","Overexercising"], correct:0},
    {q:"Common symptom of dehydration?", a:["Headache","Sneezing","Itchy eyes","Cough"], correct:0},
    {q:"Which food is rich in Omega-3?", a:["Salmon","Bread","Cheese","Beef"], correct:0},
    {q:"Most effective way to prevent flu?", a:["Vaccination","Herbal tea","Cold shower","Vitamin C only"], correct:0},
    {q:"Daily recommended sleep for adults?", a:["3–4 hours","5–6 hours","7–9 hours","10–12 hours"], correct:2},
    {q:"Best source of calcium?", a:["Milk","Rice","Chicken","Apple"], correct:0},
    {q:"Which habit reduces stress?", a:["Meditation","Smoking","Skipping meals","Overthinking"], correct:0},
    {q:"What is hypertension?", a:["Low blood sugar","High blood pressure","Low blood pressure","High cholesterol"], correct:1},
    {q:"Fruits high in vitamin C?", a:["Oranges","Rice","Bread","Eggs"], correct:0}
];

let db;
let balance = 0;
let answeredToday = 0;

// Check time
const now = new Date();
const hour = now.getHours();
if(hour < 19 || hour >= 22){
    document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;'>Survey is available only from 7:00 PM to 10:00 PM</h2>";
    throw new Error("Outside allowed time");
}

// IndexedDB setup
const request = indexedDB.open("HealthSurveyDB",1);
request.onupgradeneeded = (e)=>{
    db = e.target.result;
    db.createObjectStore("progress",{keyPath:"id"});
};
request.onsuccess = (e)=>{
    db = e.target.result;
    loadProgress();
};
request.onerror = (e)=>console.log("DB error", e);

function loadProgress(){
    const tx = db.transaction("progress","readonly");
    const store = tx.objectStore("progress");
    const getReq = store.get("user1");
    getReq.onsuccess = ()=>{
        const data = getReq.result;
        if(data){
            balance = data.balance;
            answeredToday = (data.lastDate===new Date().toDateString()) ? data.answeredToday : 0;
            startSurvey(data.lastQuestionIndex||0);
        } else {
            startSurvey(0);
        }
        updateBalance();
    };
}

function saveProgress(lastQuestionIndex){
    const tx = db.transaction("progress","readwrite");
    const store = tx.objectStore("progress");
    store.put({
        id:"user1",
        balance,
        lastQuestionIndex,
        lastDate:new Date().toDateString(),
        answeredToday
    });
}

function updateBalance(){
    document.getElementById("balance").innerText = "Your balance: Ksh "+balance;
}

function startSurvey(startIndex){
    let qIndex = startIndex;
    const container = document.getElementById("survey-container");
    container.innerHTML = "";

    function showQuestion(){
        if(qIndex>=questions.length || answeredToday>=3){
            container.innerHTML="<h3>Survey completed for today!</h3>";
            return;
        }
        const q = questions[qIndex];
        container.innerHTML = `<div class="question">
            <p>${q.q}</p>
            ${q.a.map((opt,i)=>`<button onclick="answer(${i})">${opt}</button>`).join("")}
        </div>`;
    }

    window.answer = function(choice){
        const q = questions[qIndex];
        answeredToday++;
        if(choice===q.correct){
            balance+=40;
        } else {
            balance-=20;
            updateBalance();
            saveProgress(qIndex+1);
            container.innerHTML="<h3>You answered wrong! Survey stops for today. Come back tomorrow.</h3>";
            return;
        }
        updateBalance();
        qIndex++;
        saveProgress(qIndex);
        if(answeredToday>=3){
            container.innerHTML="<h3>Daily question limit reached!</h3>";
            return;
        }
        showQuestion();
    }

    showQuestion();
}

// Withdraw button
document.getElementById("withdrawBtn").onclick = ()=>{
    if(balance>=150){
        const confirmActivate = confirm("Activate your account with Ksh 36 to withdraw?");
        if(confirmActivate){
            window.location.href="https://summitsolutions28.github.io/Well8372/p2003.html";
        }
    } else {
        alert("Minimum balance to withdraw is Ksh 150.");
    }
}
</script>

</body>
</html>